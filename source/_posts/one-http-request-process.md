---
title: 一次完整的 HTTP 请求过程
date: 2017-10-06 20:53:28
category: HTTP
tags:
	- http
---
**一次完整的 http 请求处理过程**

![一次完整的 http 请求处理过程](http://ov2iiuul1.bkt.clouddn.com/web_request.jpg)

**1.建立连接：**接收或者拒绝连接请求

**2.接收请求：**接收客户端请求报文中对某资源的一次请求的过程

Web 访问响应模型（Web I/O ）

- 单进程 I/O 模型：启动一个进程处理用户请求，一次只处理一个，多个请求被串行响应
- 多进程 I/O 模型：并行启动多个进程，每个进程响应一个连接请求
- 复用 I/O 结构：启动一个进程，同时响应 N 个连接请求
  实现方法：多线程模型和事件驱动
  - 多线程模型：一个进程生成 N 个线程，每个线程响应一个连接请求
  - 事件驱动：一个进程处理 N 个请求
- 复用的多进程 I/O 模型：启动 M 个进程，每个进程响应 N 个连接请求，同时接受 M*N 个请求

**3.处理请求：**服务器对请求报文进行解析，并获取请求的资源及方法等相关信息，根据方法，资源，首部和可选的主体部分对请求进行处理
元数据：请求报文首部

```
	<method> <URL> <VERSION>
   	HEADERS 格式 name:value
   	<request body>
```

   HTTP 常用请求方法（Method）
   GET, POST, HEAD, PUT, DELETE, TRACE, OPTIONS

**4.访问资源：**
服务器获取请求报文中请求的资源 web 服务器，负责向请求者提供对方请求的静态资源，或动态运行后生产的资源
资源放置于本地文件系统特定的路径：DocROOT
web 服务器资源路径映射方式：
1. docroot
2. alias
3. 虚拟主机 docroot
4. 用户家目录 docroot

**5.构建响应报文：**
一旦 web 服务器识别出了资源，就执行请求方法中描述的动作，并返回响应报文。响应报文中包含有响应状态码，响应首部，如果生成了响应主体的话，还包含响应主体
1. 响应主体：
   如果事务处理产生了响应主体，就将内容放在响应报文中并回传。响应报文通常包括：
   - 描述了响应主体 MIME(多用户互联网邮件扩展) 类型的 Content-Type 首部
   - 描述了响应主体长度的 Content-Length
   - 实际报文的主体内容
2. URL 重定向:
   web 服务构建的响应并非客户端请求的资源，而是资源另外一个访问路径
   - 永久重定向
   - 临时重定向
3. MIME 类型：
   web 服务器要负责确定响应主体的 MIME 类型。多种配置服务器的方法可将 MIME 类型与资源管理起来
   - 魔法分类：Apache web 服务器可以扫描每个资源的内容，并将其与一个一直的模式表（被称为魔法文件）进行匹配，以决定每个文件的 MIME 类型。这样做可能比较慢，但很方便，尤其是文件没有标准扩展名时
   - 显示分类：可以对 web 服务器进行配置，使其不考虑文件的扩展名或内容，强制特定文件或目录内容拥有某个 MIME 类型
   - 类型协商：有些 web 服务器经过配置，可以以多种文档格式来存储资源。在这种情况下，可以配置 web 服务器，使其可以通过与用户的协商来决定使用哪种格式（及相关的 MIME 类型）最好

**6.发送响应报文**
web 服务器通过连接发送数据时也会面临与接收数据一样的问题。服务器可能有多条到各个客户端的连接，有些是空闲的，有些在向服务器发送数据，还有一些在向客户端回送响应数据。服务器要记录连接的状态，还要特别注意对持久连接的处理。对非持久连接而言，服务器应该在发送了整条报文之后，关闭自己这一端的连接。对持久连接来说，连接可能仍保持打开状态，在这种情况下，服务器要正确地计算 Content-Length 首部，不然客户端就无法知道响应什么时候结束了。

**7.记录日志**
最后，当事务结束时，web 服务器会在日志文件中添加一个条目，描述已执行的事务



END!