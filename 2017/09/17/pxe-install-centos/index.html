<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>CentOS 7 搭建操作系统自动化安装服务 | Weidong</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="自动化安装操作系统," />
  

  <meta name="description" content="环境  服务端使用 CentOS 7.3 客户端提供镜像版本 CentOS 7.3 SELinux 关闭 iptables 关闭 服务端 IP 192.168.1.250 ，客户端 IP 范围 192.168.1.10-192.168.1.100 dhcp 提供客户端 ip 地址分配服务 tftp 机器启动资源加载服务 httpd 提供 yum 源  以上服务全部为一台计算机提供  安装必要软件包">
<meta name="keywords" content="自动化安装操作系统">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS 7 搭建操作系统自动化安装服务">
<meta property="og:url" content="http://www.weidong.io/2017/09/17/pxe-install-centos/index.html">
<meta property="og:site_name" content="Weidong">
<meta property="og:description" content="环境  服务端使用 CentOS 7.3 客户端提供镜像版本 CentOS 7.3 SELinux 关闭 iptables 关闭 服务端 IP 192.168.1.250 ，客户端 IP 范围 192.168.1.10-192.168.1.100 dhcp 提供客户端 ip 地址分配服务 tftp 机器启动资源加载服务 httpd 提供 yum 源  以上服务全部为一台计算机提供  安装必要软件包">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://ot6jjpn4h.bkt.clouddn.com/net_install_system.png">
<meta property="og:image" content="http://ot6jjpn4h.bkt.clouddn.com/cli1.png">
<meta property="og:image" content="http://ot6jjpn4h.bkt.clouddn.com/cli2.png">
<meta property="og:updated_time" content="2017-09-17T12:32:35.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CentOS 7 搭建操作系统自动化安装服务">
<meta name="twitter:description" content="环境  服务端使用 CentOS 7.3 客户端提供镜像版本 CentOS 7.3 SELinux 关闭 iptables 关闭 服务端 IP 192.168.1.250 ，客户端 IP 范围 192.168.1.10-192.168.1.100 dhcp 提供客户端 ip 地址分配服务 tftp 机器启动资源加载服务 httpd 提供 yum 源  以上服务全部为一台计算机提供  安装必要软件包">
<meta name="twitter:image" content="http://ot6jjpn4h.bkt.clouddn.com/net_install_system.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>




<div class="content content-post CENTER">
   <article id="post-pxe-install-centos" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">CentOS 7 搭建操作系统自动化安装服务</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.09.17</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Weidong</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </span>



      
        <span>
          <i class="icon-comment"></i>
          <a href="http://www.weidong.io/2017/09/17/pxe-install-centos/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <p><strong>环境</strong></p>
<ul>
<li>服务端使用 CentOS 7.3</li>
<li>客户端提供镜像版本 CentOS 7.3</li>
<li>SELinux 关闭</li>
<li>iptables 关闭</li>
<li>服务端 IP 192.168.1.250 ，客户端 IP 范围 192.168.1.10-192.168.1.100</li>
<li>dhcp 提供客户端 ip 地址分配服务</li>
<li>tftp 机器启动资源加载服务</li>
<li>httpd 提供 yum 源</li>
</ul>
<p>以上服务全部为一台计算机提供</p>
<p><img src="http://ot6jjpn4h.bkt.clouddn.com/net_install_system.png" alt="拓扑图"></p>
<p><strong>安装必要软件包</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum install -y dhcp</div><div class="line">yum install -y tftp-server</div><div class="line">yum install -y httpd</div><div class="line">yum install -y syslinux</div></pre></td></tr></table></figure>
<p><strong>配置 tftp server</strong></p>
<p>启动 tftp 服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[root@localhost ~]<span class="comment"># systemctl start tftp.service</span></div><div class="line"><span class="comment">## 检查 tftp 端口 69 是否活动</span></div><div class="line">[root@localhost ~]<span class="comment"># ss -unl | grep '69'</span></div><div class="line">UNCONN     0      0           :::69                      :::*</div></pre></td></tr></table></figure>
<p>拷贝必要文件到 tftp 工作目录( <code>/var/lib/tftpboot/</code> )</p>
<p>从 CentOS 7.3 光盘镜像中将 <code>initrd.img、vmlinuz、isolinux.cfg</code> 拷贝到 <code>/var/lib/tftpboot/</code> 中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cp /mnt/images/pxeboot/&#123;initrd.img,vmlinuz&#125; /var/lib/tftpboot/ </span></div><div class="line">[root@localhost ~]<span class="comment"># cp /mnt/isolinux/isolinux.cfg /var/lib/tftpboot/</span></div></pre></td></tr></table></figure>
<p>现在还需要一个菜单背景文件( <code>mune.c32</code> )和启动文件 ( <code>pxelinux.0</code> )</p>
<p>这两个文件在刚才安装的 <code>syslinux</code>  包中</p>
<p>列出 <code>syslinux</code> 的文件查看这两个文件的路径并复制到 <code>/var/lib/tftpboot/</code> 中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># rpm -ql syslinux | grep 'menu.c32\|pxelinux.0'</span></div><div class="line">/usr/share/syslinux/gpxelinux.0</div><div class="line">/usr/share/syslinux/menu.c32</div><div class="line">/usr/share/syslinux/pxelinux.0</div><div class="line">/usr/share/syslinux/vesamenu.c32</div><div class="line">[root@localhost ~]<span class="comment"># cp /usr/share/syslinux/&#123;menu.c32,pxelinux.0&#125; /var/lib/tftpboot/</span></div></pre></td></tr></table></figure>
<p>切换至 <code>/var/lib/tftpboot/</code> 列出当前文件列表</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /var/lib/tftpboot/</span></div><div class="line">[root@localhost tftpboot]<span class="comment"># ll</span></div><div class="line">total 47716</div><div class="line">-rw-r--r-- 1 root root 43372552 Sep 17 17:49 initrd.img</div><div class="line">-rw-r--r-- 1 root root     3068 Sep 17 17:54 isolinux.cfg</div><div class="line">-rw-r--r-- 1 root root    55012 Sep 17 18:02 menu.c32</div><div class="line">-rw-r--r-- 1 root root    26764 Sep 17 18:02 pxelinux.0</div><div class="line">-rwxr-xr-x 1 root root  5392080 Sep 17 17:49 vmlinuz</div></pre></td></tr></table></figure>
<p>创建文件夹 <code>pxelinux.cfg</code> </p>
<p>将 <code>isolinux.cfg</code> 移动到 <code>pexlinux.cfg</code> 文件夹中并改名为 <code>default</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost tftpboot]<span class="comment"># mkdir pxelinux.cfg</span></div><div class="line">[root@localhost tftpboot]<span class="comment"># mv isolinux.cfg pxelinux.cfg/default</span></div></pre></td></tr></table></figure>
<p>当前目录结构</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost tftpboot]<span class="comment"># tree</span></div><div class="line">.</div><div class="line">├── initrd.img</div><div class="line">├── menu.c32</div><div class="line">├── pxelinux.0</div><div class="line">├── pxelinux.cfg</div><div class="line">│   └── default</div><div class="line">└── vmlinuz</div><div class="line"></div><div class="line">1 directory, 5 files</div><div class="line">[root@localhost tftpboot]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p><strong>配置 httpd server </strong></p>
<p>启动 httpd 服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># systemctl status httpd</span></div><div class="line">● httpd.service - The Apache HTTP Server</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/httpd.service; disabled; vendor preset: disabled)</div><div class="line">   Active: inactive (dead)</div><div class="line">     Docs: man:httpd(8)</div><div class="line">           man:apachectl(8)</div><div class="line">[root@localhost ~]<span class="comment"># systemctl start httpd</span></div><div class="line">[root@localhost ~]<span class="comment"># ss -tan | grep '80'</span></div><div class="line">LISTEN     0      128         :::80                      :::*                  </div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>切换到 httpd 工作目录 <code>/var/www/html</code></p>
<p> 创建 <code>yum</code> 文件存放目录与 <code>kickstart</code> 文件存放目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /var/www/html/</span></div><div class="line">[root@localhost html]<span class="comment"># mkdir -p &#123;centos/7,ksfile&#125;</span></div><div class="line">[root@localhost html]<span class="comment"># tree</span></div><div class="line">.</div><div class="line">├── centos</div><div class="line">│   └── 7</div><div class="line">└── ksfile</div><div class="line"></div><div class="line">3 directories, 0 files</div><div class="line">[root@localhost html]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>配置<code>kickstart</code> 文件</p>
<p>可以把系统安装时自动生成 的<code>kickstart</code> 文件拷贝一份改一下就可以了，一般在 <code>root</code> 家目录一个名为<code>anaconda-ks.cfg</code> 的文件，还可以安装 <code>system-config-kickstart</code> 这个程序包来制作，不过需要图形界面的支持，而且不能添加 <code>lvm</code> 分区</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#platform=x86, AMD64, or Intel EM64T</span></div><div class="line"><span class="comment">#version=DEVEL</span></div><div class="line"><span class="comment"># Install OS instead of upgrade</span></div><div class="line">install</div><div class="line"><span class="comment"># Keyboard layouts</span></div><div class="line"><span class="comment"># old format: keyboard us</span></div><div class="line"><span class="comment"># new format:</span></div><div class="line">keyboard --vckeymap=us --xlayouts=<span class="string">'us'</span></div><div class="line"><span class="comment"># Root password</span></div><div class="line">rootpw --iscrypted <span class="variable">$1</span><span class="variable">$iUbShR9k</span><span class="variable">$BCT3THf737s5Zs5MEREgg</span>.</div><div class="line"><span class="comment"># Use network installation</span></div><div class="line">url --url=http://192.168.1.250/centos/7</div><div class="line"><span class="comment"># System language</span></div><div class="line">lang en_US --addsupport=zh_CN.UTF-8</div><div class="line">user --name=weidong --password=<span class="variable">$6</span><span class="variable">$zQqnWSZohBYO8Zuf</span><span class="variable">$1EYd</span>/nebaz4r0PlSwXxoY8TWM5idE9uU4N3ANGLVcRp/n72OwOIUHm7hZ93zOrw3KS4dYR1N9BD6pF7a0.tAR/ --iscrypted --gecos=<span class="string">"weidong"</span></div><div class="line"><span class="comment"># Firewall configuration</span></div><div class="line">firewall --disabled</div><div class="line">repo --name=<span class="string">"Server-HighAvailability"</span> --baseurl=file:///run/install/repo/addons/HighAvailability</div><div class="line">repo --name=<span class="string">"Server-ResilientStorage"</span> --baseurl=file:///run/install/repo/addons/ResilientStorage</div><div class="line"><span class="comment"># System authorization information</span></div><div class="line">auth  --useshadow  --passalgo=sha512</div><div class="line"><span class="comment"># Use text mode install</span></div><div class="line">text</div><div class="line">firstboot --<span class="built_in">disable</span></div><div class="line"><span class="comment"># SELinux configuration</span></div><div class="line">selinux --disabled</div><div class="line"></div><div class="line"><span class="comment"># System services</span></div><div class="line">services --enabled=<span class="string">"chronyd"</span></div><div class="line">ignoredisk --only-use=sda</div><div class="line"><span class="comment"># Network information</span></div><div class="line">network  --bootproto=dhcp --device=ens33</div><div class="line">network  --bootproto=dhcp --device=None</div><div class="line"><span class="comment"># Reboot after installation</span></div><div class="line">reboot</div><div class="line"><span class="comment"># System timezone</span></div><div class="line">timezone Asia/Shanghai</div><div class="line"><span class="comment"># System bootloader configuration</span></div><div class="line">bootloader --location=mbr --boot-drive=sda</div><div class="line"><span class="comment"># Clear the Master Boot Record</span></div><div class="line">zerombr</div><div class="line"><span class="comment"># Partition clearing information</span></div><div class="line">clearpart --all --initlabel --drives=sda</div><div class="line"><span class="comment"># Disk partitioning information</span></div><div class="line">part pv.338 --fstype=<span class="string">"lvmpv"</span> --ondisk=sda --size=101899</div><div class="line">part /boot --fstype=<span class="string">"xfs"</span> --ondisk=sda --size=500</div><div class="line">volgroup lvmdisk --pesize=4096 pv.338</div><div class="line">logvol /  --fstype=<span class="string">"xfs"</span> --size=51200 --name=root --vgname=lvmdisk</div><div class="line">logvol /<span class="built_in">local</span>  --fstype=<span class="string">"xfs"</span> --size=46600 --name=<span class="built_in">local</span> --vgname=lvmdisk</div><div class="line">logvol swap  --fstype=<span class="string">"swap"</span> --size=4096 --name=swap --vgname=lvmdisk</div><div class="line"></div><div class="line">%packages</div><div class="line">@^minimal</div><div class="line">@core</div><div class="line">vim</div><div class="line">lrzsz</div><div class="line">tree</div><div class="line">-NetworkManager</div><div class="line">-NetworkManager-team</div><div class="line">-NetworkManager-tui</div><div class="line">-NetworkManager-wifi</div><div class="line">-aic94xx-firmware</div><div class="line">-alsa-firmware</div><div class="line">-biosdevname</div><div class="line">-dracut-config-rescue</div><div class="line">-ivtv-firmware</div><div class="line">-iwl100-firmware</div><div class="line">-iwl1000-firmware</div><div class="line">-iwl105-firmware</div><div class="line">-iwl135-firmware</div><div class="line">-iwl2000-firmware</div><div class="line">-iwl2030-firmware</div><div class="line">-iwl3160-firmware</div><div class="line">-iwl3945-firmware</div><div class="line">-iwl4965-firmware</div><div class="line">-iwl5000-firmware</div><div class="line">-iwl5150-firmware</div><div class="line">-iwl6000-firmware</div><div class="line">-iwl6000g2a-firmware</div><div class="line">-iwl6000g2b-firmware</div><div class="line">-iwl6050-firmware</div><div class="line">-iwl7260-firmware</div><div class="line">-iwl7265-firmware</div><div class="line">-kernel-tools</div><div class="line">-libsysfs</div><div class="line">-linux-firmware</div><div class="line">-microcode_ctl</div><div class="line">-postfix</div><div class="line"></div><div class="line">%end</div></pre></td></tr></table></figure>
<p>确认文件是否有读权限，如果没有读权限客户端在读取文件的时候会找不到 <code>kickstart</code> 文件而报错</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ksfile]<span class="comment"># ll</span></div><div class="line">total 4</div><div class="line">-rw-r--r-- 1 root root 2360 Sep 17 18:43 centos-7-ks.cfg</div></pre></td></tr></table></figure>
<p>把<code>CentOS 7.3</code>光盘中的文件拷贝到 <code>/var/www/html/centos/7</code> 目录下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ksfile]<span class="comment"># cp -r /mnt/* /var/www/html/centos/7/</span></div></pre></td></tr></table></figure>
<p>修改启动菜单</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost ksfile]<span class="comment"># vim /var/lib/tftpboot/pxelinux.cfg/default</span></div><div class="line">[root@localhost ksfile]<span class="comment"># cat /var/lib/tftpboot/pxelinux.cfg/default</span></div><div class="line">default menu.c32</div><div class="line">timeout 600</div><div class="line"></div><div class="line">menu title CentOS Linux 7</div><div class="line"></div><div class="line">label linux</div><div class="line">  menu label ^Install CentOS Linux 7</div><div class="line">  kernel vmlinuz</div><div class="line">  append initrd=initrd.img ks=http://192.168.1.250/ksfile/centos-7-ks.cfg</div><div class="line"></div><div class="line">label <span class="built_in">local</span></div><div class="line">  menu label Boot from ^<span class="built_in">local</span> drive</div><div class="line">  localboot 0xffff</div><div class="line"></div><div class="line">menu end</div><div class="line">[root@localhost ksfile]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p><strong>配置 dhcp server</strong></p>
<p>此时 <code>dhcp</code> 还不能启动，因为还没有配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## 打开默认的配置文件会有提示,参考这个示例文件来修改配置文件</span></div><div class="line">[root@localhost ~]<span class="comment"># cat /etc/dhcp/dhcpd.conf </span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># DHCP Server Configuration file.</span></div><div class="line"><span class="comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span></div><div class="line"><span class="comment">#   see dhcpd.conf(5) man page</span></div><div class="line"><span class="comment">#</span></div></pre></td></tr></table></figure>
<p>修改好的配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cat /etc/dhcp/dhcpd.conf </span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># DHCP Server Configuration file.</span></div><div class="line"><span class="comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span></div><div class="line"><span class="comment">#   see dhcpd.conf(5) man page</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment"># option definitions common to all supported networks...</span></div><div class="line">option domain-name <span class="string">"test.local"</span>;</div><div class="line">option domain-name-servers 192.168.1.1;</div><div class="line"></div><div class="line">default-lease-time 600;</div><div class="line">max-lease-time 7200;</div><div class="line"> </div><div class="line">subnet 192.168.1.0 netmask 255.255.255.0 &#123;</div><div class="line">        range 192.168.1.10 192.168.1.100;</div><div class="line">        next-server 192.168.1.250;</div><div class="line">        filename <span class="string">"pxelinux.0"</span>;</div><div class="line">&#125;</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>启动 dhcp 服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># systemctl start dhcpd</span></div><div class="line">[root@localhost ~]<span class="comment"># systemctl is-active dhcpd</span></div><div class="line">active</div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p><strong>启动客户端测试</strong></p>
<p>客户端开机选择网络启动（需要网卡支持 PXE）</p>
<p><img src="http://ot6jjpn4h.bkt.clouddn.com/cli1.png" alt="客户机启动设置"></p>
<p>读取菜单文件成功</p>
<p><img src="http://ot6jjpn4h.bkt.clouddn.com/cli2.png" alt="客户端成功读取到菜单文件"></p>
<p><strong>FAQ:</strong></p>
<ul>
<li>如果是从 <code>root</code> 目录拷贝的 <code>kickstart</code> 文件一定要将权限加上读(r)的权限</li>
<li>客户机内存必须大于 1G 以上，否则会出现挂载出错导致无法安装</li>
</ul>
<p>END!</p>

    
  </div>
</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2017/09/15/parted/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="hide pull-right" href="/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'forsigner';
    
    var disqus_url = 'http://www.weidong.io/2017/09/17/pxe-install-centos/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//forsigner.disqus.com/count.js" async></script>



    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
